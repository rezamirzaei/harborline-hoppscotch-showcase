{% extends "base.html" %}

{% block content %}
<section class="page-header">
  <div>
    <h1>Live Ops</h1>
    <p>Watch order + payment events in real time (SSE + WebSocket). Run a workflow to generate traffic instantly.</p>
  </div>
  <div class="form-actions">
    <a class="button secondary" href="/ui/hoppscotch">Hoppscotch Lab</a>
    {% if hoppscotch_app_url %}
      <a class="button tertiary" href="{{ hoppscotch_app_url }}" target="_blank">Open Hoppscotch</a>
    {% endif %}
  </div>
</section>

<section class="card highlight" data-ops-simulator>
  <div>
    <h2>Ops simulator</h2>
    <p>Create order → reserve inventory → capture payment. The event bus broadcasts each step to both streams below.</p>
    <div id="ops-status" class="muted"></div>
  </div>
  <div class="form-actions">
    <button class="button" id="ops-run" type="button">Run workflow</button>
    <a class="button secondary" href="/ui/orders">View orders</a>
  </div>
</section>

<section class="grid split">
  <div class="card console" data-sse>
    <h2>SSE Stream</h2>
    <p class="muted">Auto-connects to <code>/stream/orders</code>. Use the filter to focus on one workflow.</p>
    <label class="field">
      <span>Filter by Order ID (optional)</span>
      <input id="sse-order-id" type="text" placeholder="order-id" />
    </label>
    <div class="form-actions">
      <button class="button" id="sse-start" type="button">Start SSE</button>
      <button class="button secondary" id="sse-stop" type="button">Stop SSE</button>
      <button class="button tertiary" id="sse-clear" type="button">Clear</button>
    </div>
    <pre id="sse-log" class="code-block"></pre>
  </div>
  <div class="card console" data-ws>
    <h2>WebSocket Stream</h2>
    <p class="muted">Auto-connects to <code>/ws/shipments</code> for realtime updates.</p>
    <div class="form-actions">
      <button class="button" id="ws-connect" type="button">Connect WS</button>
      <button class="button secondary" id="ws-disconnect" type="button">Disconnect WS</button>
      <button class="button tertiary" id="ws-clear" type="button">Clear</button>
    </div>
    <pre id="ws-log" class="code-block"></pre>
  </div>
</section>

<section class="card inset" data-hoppscotch-realtime>
  <h2>Try it in Hoppscotch</h2>
  <p class="muted">
    Import the
    <a class="link" href="/hoppscotch/harborline.collection.json">collection</a>
    and
    <a class="link" href="/hoppscotch/harborline.environment.json">environment</a>,
    then Hoppscotch → Realtime: connect to the same streams and watch events while you run the workflow.
  </p>
  <ul>
    <li>SSE URL: <code id="hoppscotch-sse-url">/stream/orders</code></li>
    <li>WS URL: <code id="hoppscotch-ws-url">/ws/shipments</code></li>
  </ul>
</section>
{% endblock %}
